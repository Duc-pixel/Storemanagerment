CREATE DATABASE QuanLyCuaHang;
GO
USE QuanLyCuaHang;
GO

-- BẢNG NHÀ PHÂN PHỐI
CREATE TABLE NHAPHANPHOI (
    MaNPP INT PRIMARY KEY,
    TenNPP NVARCHAR(50) NOT NULL,
    DiaChi NVARCHAR(50),
    SDT NVARCHAR(10) CHECK (LEN(SDT) = 10 AND ISNUMERIC(SDT) = 1)
);

-- BẢNG SẢN PHẨM
CREATE TABLE SANPHAM (
    MaSP INT PRIMARY KEY,
    TenSP NVARCHAR(20) NOT NULL,
    MauSac NVARCHAR(10),
    CanNang DECIMAL(9,1),
    Gia DECIMAL(9,1),
    LoaiSP NVARCHAR(20) CHECK (LoaiSP IN ('PC', 'Laptop', 'Printer')),
    MaNPP INT,
    FOREIGN KEY (MaNPP) REFERENCES NHAPHANPHOI(MaNPP)
);

-- BẢNG NHÂN VIÊN
CREATE TABLE NHANVIEN (
    MaNV INT PRIMARY KEY,
    TenNV NVARCHAR(50),
    GioiTinh CHAR(3),
    DienThoai CHAR(10) CHECK (LEN(DienThoai) = 10),
    NgayLam DATETIME,
    Luong DECIMAL(9,1)
);

-- BẢNG TÀI KHOẢN ĐĂNG NHẬP
CREATE TABLE TAIKHOAN (
    MaNV INT PRIMARY KEY,
    TenDangNhap NVARCHAR(50) UNIQUE NOT NULL,
    MatKhau NVARCHAR(50) NOT NULL,
    VaiTro NVARCHAR(20) CHECK (VaiTro IN ('Admin', 'NhanVien')),
    FOREIGN KEY (MaNV) REFERENCES NHANVIEN(MaNV)
);

-- BẢNG KHÁCH HÀNG
CREATE TABLE KHACHHANG (
    MaKH INT PRIMARY KEY,
    TenKH NVARCHAR(50),
    DiaChi NVARCHAR(50),
    DienThoai CHAR(10) CHECK (LEN(DienThoai) = 10)
);

-- BẢNG HÓA ĐƠN
CREATE TABLE HOADON (
    MaHD INT PRIMARY KEY,
    MaKH INT,
    MaNV INT,
    NgayBanHang DATETIME,
    NgayNhanHang DATETIME,
    FOREIGN KEY (MaKH) REFERENCES KHACHHANG(MaKH),
    FOREIGN KEY (MaNV) REFERENCES NHANVIEN(MaNV)
);

-- CHI TIẾT HÓA ĐƠN (XÓA CỘT TỔNG VÀ GIA DƯ THỪA)
CREATE TABLE CHITIET_HOADON (
    MaHD INT,
    MaSP INT,
    SoLuong INT CHECK (SoLuong > 0),
    PRIMARY KEY (MaHD, MaSP),
    FOREIGN KEY (MaHD) REFERENCES HOADON(MaHD),
    FOREIGN KEY (MaSP) REFERENCES SANPHAM(MaSP)
);

-- KHO HÀNG
CREATE TABLE KHOHANG (
    MaKho INT,
    MaSP INT,
    NgayCapNhat DATETIME,
    SoLuong INT CHECK (SoLuong >= 0),
    TrangThai NVARCHAR(20) CHECK (TrangThai IN (N'Còn hàng', N'Hết hàng')),
    PRIMARY KEY (MaKho, MaSP),
    FOREIGN KEY (MaSP) REFERENCES SANPHAM(MaSP)
);

-- PC (KHÔNG LƯU GIA)
CREATE TABLE PC (
    MaSP INT PRIMARY KEY,
    Speed FLOAT,
    RAM INT,
    HD INT,
    FOREIGN KEY (MaSP) REFERENCES SANPHAM(MaSP)
);

-- LAPTOP (KHÔNG LƯU GIA)
CREATE TABLE LAPTOP (
    MaSP INT PRIMARY KEY,
    Speed FLOAT,
    RAM INT,
    HD INT,
    Screen FLOAT,
    FOREIGN KEY (MaSP) REFERENCES SANPHAM(MaSP)
);

-- PRINTER (KHÔNG LƯU GIA)
CREATE TABLE PRINTER (
    MaSP INT PRIMARY KEY,
    Color BIT,
    Type NVARCHAR(20),
    FOREIGN KEY (MaSP) REFERENCES SANPHAM(MaSP)
);


CREATE TABLE TAIKHOAN (
    MaNV INT PRIMARY KEY,
    TenDangNhap NVARCHAR(50) UNIQUE NOT NULL,
    MatKhau NVARCHAR(50) NOT NULL,
    VaiTro NVARCHAR(20) CHECK (VaiTro IN ('Admin', 'NhanVien')),
    FOREIGN KEY (MaNV) REFERENCES NHANVIEN(MaNV)
);	


